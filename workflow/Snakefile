import os
import sys
import math
from snakemake.utils import min_version
import pandas as pd

min_version("6.6")

SDIR = os.path.realpath(os.path.dirname(srcdir("Snakefile")))
shell.prefix(f"export PATH=$PWD/fastCN:$PATH; set -eo pipefail;")


include: "rules/reference.smk"
include: "rules/mapping.smk"
include: "rules/cn-calling.smk"


wildcard_constraints:
    sm="|".join(config["reads"].keys()),


fai_df = pd.read_csv(
    f'{config["fasta"]}.fai',
    sep="\t",
    header=None,
    names=["chr", "length", "offset", "bases", "bytes"],
)
num_contigs_in_ref = fai_df.shape[0]


rule all:
    input:
        expand(
            rules.merge_bam.output,
            sm=config["reads"].keys(),
            sample=config["reference"],
        ),


"""
        expand(
            rules.fastcn_GC_bin.output
            + rules.make_windows.output
            + rules.autosome_control_windows.output
            + rules.chrX_control_windows.output,
            sample=config["reference"],
        ),
"""
